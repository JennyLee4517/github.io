---
title: "Oracle 6ì¼ì°¨ : PL/SQL, ë£¨í”„, ì»¤ì„œ"
date: 2019-03-28 13:00:00 -0400
categories: SQL


---

## PL/SQL

- SQLì–¸ì–´ì— ì ˆì°¨ì  ì–¸ì–´ìš”ì†Œë¥¼ ì¶”ê°€í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´

```sql
-- í˜•ì‹
DECLARE
	ë³€ìˆ˜, ì»¤ì„œ â€¦
BEGIN	
		SQLë¬¸, PL/SQLë¬¸
END;
	
-- ì½˜ì†”ì—ì„œ ì‹¤í–‰ì‹œ / 
-- ì½˜ì†”ì—ì„œ ì‹¤í–‰ì‹œ ê²°ê³¼ê°’ì´ ì•ˆë³´ì¼ ê²½ìš° SET SERVEROUTPUT ONì„ í•œë²ˆë§Œ ì£¼ë©´ ëœë‹¤
```

### ğŸ£ ì‹¤ìŠµí•˜ê¸°

```sql
--ì˜ˆì œ1
	DECLARE
		v_no number(4,1);
	BEGIN
		v_no  := 40; -- ì˜¤ë¼í´ì˜ ëŒ€ì…ì—°ì‚°ìëŠ” := ì´ë‹¤. ë™ë“±ë¹„êµëŠ” = ì´ê³ ..
		DBMS_OUTPUT.PUT_LINE(v_no);
	END
	
-- ì˜ˆì œ2
	DECLARE
		vempno number(4);
		vename varchar2(10);		
	BEGIN
		select empno, ename
		into vempno, vename
		from emp
		where empno=7369;
		DBMS_OUTPUT.PUT_LINE( vempno||' '||vename );
	END;
	/
	
-- ì˜ˆì œ3
	DECLARE
		v_year number(4) := 2022;
		v_ani number(2) := mod(v_year, 12); /*ë‚˜ë¨¸ì§€êµ¬í•¨*/
	BEGIN
		if v_ani = 0 then 
		DBMS_OUTPUT.PUT_LINE(v_year||'ë…„ë„ ìƒì€ ë¼ì§€ë  ì…ë‹ˆë‹¤');
		elsif v_ani = 1 then 
		DBMS_OUTPUT.PUT_LINE(v_year||'ë…„ë„ ìƒì€ ì¥ë  ì…ë‹ˆë‹¤');
		elsif v_ani = 2 then 
		DBMS_OUTPUT.PUT_v_year||'ë…„ë„ ìƒì€ ì†Œë  ì…ë‹ˆë‹¤');
		elsif v_ani = 3 
		DBMS_OUTPUT.PUT_LINE(v_year||'ë…„ë„ ìƒì€ í˜¸ë‘ì´ë  ì…ë‹ˆë‹¤');
		elsif v_ani = 4 then 
		DBMS_OUTPUT.PUT_LINE(v_year||'ë…„ë„ ìƒì€ í† ë¼ë  ì…ë‹ˆë‹¤');
		elsif v_ani = 5 then 
		DBMS_OUTPUT.PUT_LINE(v_year||'ë…„ë„ ìƒì€ ìš©ë  ì…ë‹ˆë‹¤');
		elsif v_ani = 6 then 
		DBMS_OUTPUT.PUT_LINE(v_year||'ë…„ë„ ìƒì€ ë±€ë  ì…ë‹ˆë‹¤');
		elsif v_ani = 7 then 
		DBMS_OUTPUT.PUT_LINE(v_year||'ë…„ë„ ìƒì€ ë§ë  ì…ë‹ˆë‹¤');
		elsif v_ani = 8 then 
		DBMS_OUTPUT.PUT_LINE(v_year||'ë…„ë„ ìƒì€ ì–‘ë  ì…ë‹ˆë‹¤');
		elsif v_ani = 9 then 
		DBMS_OUTPUT.PUT_LINE(v_year||'ë…„ë„ ìƒì€ ì›ìˆ­ì´ë  ì…ë‹ˆë‹¤');
		elsif v_ani = 10 then 
		DBMS_OUTPUT.PUT_LINE(v_year||'ë…„ë„ ìƒì€ ë‹­ë  ì…ë‹ˆë‹¤');
		elsif v_ani = 11 then 
		DBMS_OUTPUT.PUT_LINE(v_year||'ë…„ë„ ìƒì€ ê°œë  ì…ë‹ˆë‹¤');
		end if
	END;
	/
		
	--ì‹¤ìŠµë¬¸ì œ
	--v_noì— ì´ˆê¸°ê°’ìœ¼ë¡œ ìˆ«ìì„ ì§€ì •í•œ í›„ 
	-- v_noê°€ ì§ìˆ˜ì´ë©´ 'ìˆ«ì'ëŠ” ì§ìˆ˜ì…ë‹ˆë‹¤
	-- í™€ìˆ˜ì´ë©´ 'ìˆ«ì'ëŠ” í™€ìˆ˜ì…ë‹ˆë‹¤ ë¼ê³  ì¶œë ¥í•˜ê¸°
		
		DECLARE
			v_no number(4) := 10;
		BEGIN
			if mod(v_no, 2)=0 then
			DBMS_OUTPUT.PUT_LIND(v_no||'ëŠ” ì§ìˆ˜ì…ë‹ˆë‹¤.');
			elsif mod(v_no, 2)=1 then
			DBMS_OUTPUT.PUT_LIND(v_no||'ëŠ” í™€ìˆ˜ì…ë‹ˆë‹¤.');
			end if
		END; 
/
```



## ë°˜ë³µë¬¸

```sql
-- í˜•ì‹
LOOP 
  ëª…ë ¹ë¬¸;
  EXITWHEN ì¡°ê±´ 
END LOOP;
```

### ğŸ£ ì‹¤ìŠµí•˜ê¸°

```sql
-- 1ë¶€í„° 10ê¹Œì§€ ì¶œë ¥
DECLARE 
    num NUMBER(2) := 1; 
BEGIN 
    LOOP 
        dbms_output.Put_line(num); 
        num := num + 1; 
        exit WHEN num > 10; 
    END LOOP; 
END; 
/ 
		
		
-- guduë¼ëŠ” ë³€ìˆ˜ì— ìˆ«ìë¥¼ ì§€ì •í•œ í›„ 
-- ê·¸ ìˆ«ìì— í•´ë‹¹í•˜ëŠ” êµ¬êµ¬ë‹¨ì„ ì¶œë ¥
DECLARE 
    gudu NUMBER(5) := 8; 
    num  NUMBER(5) := 1; 
BEGIN 
    LOOP 
        dbms_output.Put_line(gudu 
                             ||' x ' 
                             ||num 
                             ||' = ' 
                             ||gudu * num); 
        num := num + 1; 
        exit WHEN num > 9; 
    END LOOP; 
END; 
/ 
```

- ì„ ì–¸ë¶€ì—ì„œ, **ë³€ìˆ˜ëª…í…Œì´ë¸”ëª….ì»¬ëŸ¼ëª…%TYPE;** ë¼ë‘ë©´, í•´ë‹¹  í…Œì´ë¸”ì˜ ì»¬ëŸ¼ì˜ ë°ì´í„°íƒ€ì…ì„ ì°¸ì¡°í•˜ê²Œ ëœë‹¤.
- ì¦‰ ì´ ê²½ìš° í…Œì´ë¸”ìª½ì—ì„œ íƒ€ì…ì„ ìˆ˜ì •í•˜ë©´ í”„ë¡œê·¸ë¨ì—ì„œëŠ” ìë™ìœ¼ë¡œ ë°˜ì˜í•˜ë¯€ë¡œ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ”ê²Œ ì¥ì 

```sql
DECLARE 
  vempno emp.empno%TYPE; 
  vename emp.ename%TYPE; 
  vcomm emp.comm%TYPE; 
BEGIN 
-- ì„¸ê°œì˜ ì»¬ëŸ¼ê°’ì„ ì¡°íšŒí•´ì„œ ìœ„ì˜ ì„ ì–¸ëœ ë³€ìˆ˜ì— ë„£ì–´ì¤€ë‹¤
  SELECT empno, 
         ename, 
         comm 
  INTO   vempno, 
         vename, 
         vcomm 
  FROM   emp 
  WHERE  empno=7369; 
   
  IF vcomm IS NOT NULL THEN 
    dbms_output.put_line(vename 
    ||'ë‹˜ì˜ ì»¤ë¯¸ì…˜ì€ ' 
    ||vcomm 
    ||'ë§Œì› ì…ë‹ˆë‹¤.' 
    ||); 
  ELSE 
    dbms_output.Put_line(vename 
    ||'ë‹˜ì€ ì»¤ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.'); 
  END IF; 
END;

--ì‹¤ìŠµì˜ˆì œ

-- angel ê³„ì •ì˜ shop í…Œì´ë¸”ë¡œ ë¬¸ì œë¥¼ í‘¸ì„¸ìš”
-- shop í…Œì´ë¸”ì—ì„œ ìƒí’ˆëª…ì´ 'ë¸”ë™ì§„' ìƒ‰ìƒê³¼ ë‹¨ê°€ë¥¼ ì–»ì–´ë‚´ì„œ ì¶œë ¥í•˜ì„¸ìš”.
-- ì¶œë ¥ì˜ˆ : ë¸”ë™ì§„ë°”ì§€ëŠ” blackìƒ‰ìƒì´ë©° 23000ì› ì…ë‹ˆë‹¤
DECLARE 
    sname  shop.sangpum%TYPE; 
    scolor shop.color%TYPE; 
    sprice shop.price%TYPE; 
BEGIN 
    SELECT sangpum, 
           color, 
           price 
    INTO   sname, scolor, sprice 
    FROM   shop 
    WHERE  sangpum = 'ë¸”ë™ì§„'; 

    dbms_output.Put_line(sname 
                         ||'ì€(ëŠ”) ' 
                         ||scolor 
                         ||'ìƒ‰ìƒì´ë©°ã…‹' 
                         ||sprice 
                         ||'ì› ì…ë‹ˆë‹¤'); 
END; 
/ 
```



## ì¡°ê±´ë¬¸

```sql
-- í˜•ì‹
 CASE í‘œí˜„ì‹
		WHEN ê°’1 THEN ê²°ê³¼1
		WHEN ê°’2 THEN ê²°ê³¼2
		[ELSE ê²°ê³¼3]
END;
	
	
DECLARE 
    vgrade   CHAR(1) := 'B'; 
    vmessage VARCHAR2(20); 
BEGIN 
    vmessage := CASE vgrade 
                  WHEN 'A' THEN 'Excellent' 
                  WHEN 'B' THEN 'Very Good' 
                  WHEN 'C' THEN 'Good' 
                  ELSE 'Bad' 
                END; 

    dbms_output.Put_line(vgrade 
                         ||': ' 
                         ||vmessage); 
END; 

/ 
	
	
FOR counter IN [REVERSE] ì‹œì‘ê°’..ìµœì¢…ê°’ 
LOOP 
  ë¬¸ì¥1;ë¬¸ì¥2;END LOOP;
		
BEGIN 
    FOR counter IN 1..4 LOOP 
        dbms_output.Put_line('Hello' 
                             ||counter); 
    END LOOP; 
END; 

/ 

-- FORë¬¸ì„ í™œìš©í•˜ì—¬ êµ¬êµ¬ë‹¨ ì¨ë³´ê¸°
			
DECLARE 
    gudu NUMBER(2) := 8; 
BEGIN 
    FOR counter IN 1..9 LOOP 
        dbms_output.Put_line(gudu 
                             ||' x ' 
                             ||counter 
                             ||' = ' 
                             ||gudu * counter); 
    END LOOP; 
END; 
/ 
```



## ì»¤ì„œ

- sqlë¬¸ì„ì€ ì‹¤í–‰ë  ë•Œë§ˆë‹¤ ëª…ë ¹ì´ ë¶„ì„ë˜ê³  ì‹¤í–‰ë˜ì–´ ê²°ê³¼ë¥¼ ë³´ê³ í•˜ê¸° ìœ„í•œ íŠ¹ë³„í•œ ë©”ëª¨ë¦¬ì˜ì—­ì„ ì‚¬ìš©í•˜ëŠ”ë° ì´ ì˜ì—­ì„ ì°¸ì¡°í•˜ëŠ”ê²ƒì´ ì»¤ì„œì´ë‹¤.

| ì»¤ì„œ ì†ì„±    | ë°˜í™˜ê°’                                                    |
| ------------ | --------------------------------------------------------- |
| sql%rowcount | ì‹¤í–‰ëœí–‰ ìˆ˜ë¥¼ë°˜í™˜                                         |
| sql%found    | ê°€ì¥ ìµœê·¼ì˜sqlë¬¸ì´í•˜ë‚˜ ì´ìƒì˜ í–‰ì— ì˜í–¥ì„ ì¤€ê²½ìš°true ë°˜í™˜ |
| sql%notfound | ê²°ê³¼ í–‰ì´ ì—†ëŠ”ê²½ìš°true ë°˜í™˜                               |
| sql%isopen   | í•­ìƒfalse ë°˜í™˜(í•­ìƒcloseë¥¼í•˜ê¸° ë•Œë¬¸ì— í•­ìƒfalse)          |

```sql
-- í˜•ì‹
CURSOR ì»¤ì„œëª… 
IS 
  SELECT ë¬¸ì¥; --selectì˜ ê²°ê³¼ë¥¼ ì»¤ì„œì— ì €ì¥
	
-- cursorì˜ ë°ì´íƒ€ë¥¼ ë°˜ë³µì ìœ¼ë¡œ ì¶œë ¥ì„ í•˜ë ¤ë©´
-- loop ì´ë‚˜ for ë¬¸ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤
	
LOOP 
  FETCH ì»¤ì„œëª… 
  INTO  ë³€ìˆ˜ëª…1, 
        ë³€ìˆ˜ëª…2;EXITWHEN ì»¤ì„œëª…%NOTFOUND;END LOOP;
        
-- FORë¬¸ì€ ì»¤ì„œ ìë™ ì˜¤í”ˆ
	FOR ë ˆì½”ë“œëª… IN ì»¤ì„œëª… LOOP
		ë¬¸ì¥1;
		ë¬¸ì¥2;
	END LOOP;	
	
-- ì»¤ì„œë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ OPEN ì»¤ì„œëª…
-- ëª¨ë‘ ì‚¬ìš©í•œ í›„ì—ëŠ” CLOSE ì»¤ì„œëª…
```

### ğŸ£ ì‹¤ìŠµí•˜ê¸°

```sql
--@myscott
DECLARE 
    CURSOR c1 IS 
      SELECT deptno, 
             dname, 
             loc 
      FROM   dept; 
BEGIN 
    --ì»¤ì„œì— ì €ì¥ëœ ë ˆì½”ë“œë¥¼ ë°˜ë³µí•´ì„œ ì¶œë ¥, ìë™ìœ¼ë¡œ ì»¤ì„œê°€ ì˜¤í”ˆ 
    FOR dept_recored IN c1 LOOP 
        EXIT WHEN c1%NOTFOUND; 
        --ê²€ìƒ‰ëœ ë°ì´íƒ€ê°€ ì—†ìœ¼ë©´ ë°˜ë³µë¬¸ì„ ë¹ ì ¸ë‚˜ê°„ë‹¤ 

        dbms_output.Put_line(dept_record.deptno 
                             ||' ' 
                             ||dept_record.dname 
                             ||' ' 
                             ||dept_record.loc); 
    END LOOP; 
END; 

/ 
	
--@angel
DECLARE 
    vsum NUMBER(7) := 0; --ìƒí’ˆê°€ê²©ì˜ í•©ê³„ë¥¼ êµ¬í•  ë³€ìˆ˜ ì„ ì–¸ 
    vavg NUMBER(7) := 0; --ìƒí’ˆê°€ê²©ì˜ í‰ê· ì„ êµ¬í•  ë³€ìˆ˜ ì„ ì–¸ 
    i    NUMBER(2) := 1; --rowcountë¥¼ ë°›ì„ ë³€ìˆ˜ 
    CURSOR c1 IS 
      SELECT num, 
             sangpum, 
             color, 
             price 
      FROM   shop; 
BEGIN 
    --ì»¤ì„œì— ì €ì¥ëœ ë ˆì½”ë“œë¥¼ ë°˜ë³µí•´ì„œ ì¶œë ¥, ìë™ìœ¼ë¡œ ì»¤ì„œê°€ ì˜¤í”ˆ 
    FOR dept_record IN c1 LOOP 
        dbms_output.Put_line(c1%rowcount 
                             ||'ë²ˆì§¸ ìƒí’ˆ'); 

        vsum := vsum + dept_record.price; 

        EXIT WHEN c1%NOTFOUND; 
        --ê²€ìƒ‰ëœ ë°ì´íƒ€ê°€ ì—†ìœ¼ë©´ ë°˜ë³µë¬¸ì„ ë¹ ì ¸ë‚˜ê°„ë‹¤ 

        dbms_output.Put_line(dept_record.num 
                             ||' ' 
                             ||dept_record.sangpum 
                             ||' ' 
                             ||dept_record.color 
                             ||' ' 
                             ||dept_record.price); 

        i := c1%rowcount; 
    END LOOP; 

    vavg := vsum / i; 

    dbms_output.Put_line('í•©ê³„ëŠ” ' 
                         ||vsum 
                         ||' í‰ê· ì€ ' 
                         ||vavg); 
END; 

/ 
	
-- ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ í•´ë³´ì
DECLARE 
  vcnt NUMBER(5) := 0; 
  vavg NUMBER(7,1) :=0; 
  CURSOR c1 IS 
    SELECT num, 
           sangpum, 
           color, 
           price, 
           to_char(ipgoday, 'yyyy-mm-dd') iday 
    FROM   shop;

BEGIN 
    SELECT Avg(price) 
    INTO   vavg 
    FROM   shop; 

    --ìƒí’ˆë“¤ì˜ í‰ê· ì„ sql ë¬¸ìœ¼ë¡œë¶€í„° ì–»ì–´ì˜¨ë‹¤ 
    SELECT Count(*) 
    INTO   vcnt 
    FROM   shop; 

    --ì»¤ì„œì— ì €ì¥ëœ ë ˆì½”ë“œë¥¼ ë°˜ë³µí•´ì„œ ì¶œë ¥, ìë™ìœ¼ë¡œ ì»¤ì„œê°€ ì˜¤í”ˆ 
    FOR dept_record IN c1 LOOP 
        EXIT WHEN c1%NOTFOUND; 

        dbms_output.Put_line(dept_record.num 
                             ||' ' 
                             ||dept_record.sangpum 
                             ||' ' 
                             ||dept_record.color 
                             ||' ' 
                             ||dept_record.price 
                             ||' ' 
                             ||dept_record.iday); 
    END LOOP; 

    dbms_output.Put_line('ìƒí’ˆë“¤ì˜ ì´ ê°œìˆ˜: ' 
                         ||vcnt); 

    dbms_output.Put_line('ìƒí’ˆë“¤ì˜ í‰ê· ê°€: ' 
                         ||vavg); 
END; 
/ 
	
--@myscott / êµì¬ 12ì¥ p.23
DECLARE 
    tot_sum NUMBER := 0; 
    CURSOR c1 IS 
      SELECT ename, 
             sal 
      FROM   emp; 
BEGIN 
    dbms_output.Put_line('ì´ë¦„      ê¸‰ì—¬'); 

    dbms_output.Put_line('---------------'); 

    FOR emp_record IN c1 LOOP 
        tot_sum := tot_sum + emp_record.sal; 

        dbms_output.Put_line(emp_record.ename 
                             ||'      ' 
                             ||emp_record.sal); 
    -- ì™œ ì—¬ê¸°ëŠ” EXIT WHENì´ ì—†ì„ê¹Œ? 
    END LOOP; 

    dbms_output.Put_line('---------------'); 

    dbms_output.Put_line('ì´ ê¸‰ì—¬ : ' 
                         ||'       ' 
                         ||tot_sum); 
END; 
/ 

```

